<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard | Fashion Shop</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .admin-container {
        padding: 40px 10%;
      }
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        margin-bottom: 50px;
      }
      .stat-card {
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: var(--shadow);
        text-align: center;
      }
      .stat-card h2 {
        font-size: 2.5rem;
        color: var(--accent);
        margin-top: 10px;
      }

      /* Form Styles */
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        text-align: left;
      }
      .form-grid input,
      .form-grid select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        outline: none;
      }
      .btn-add {
        background: var(--accent);
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
        margin-top: 20px;
        width: 100%;
      }
      .btn-add:hover {
        opacity: 0.9;
      }

      /* Table Styles */
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: var(--shadow);
        margin-top: 20px;
      }
      th,
      td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      th {
        background: var(--primary);
        color: white;
      }
      .btn-delete {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header>
      <nav class="navbar">
        <div class="logo">Admin Panel</div>
        <ul class="nav-links">
          <li><a href="index.html">View Shop</a></li>
          <li><a href="#" onclick="logout()">Logout</a></li>
        </ul>
      </nav>
    </header>

    <div class="admin-container">
      <h1>Dashboard Overview</h1>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Users</h3>
          <h2 id="totalUsers">0</h2>
        </div>
        <div class="stat-card">
          <h3>Total Products</h3>
          <h2 id="totalProducts">0</h2>
        </div>
      </div>

      <div class="stat-card" style="text-align: left; margin-bottom: 40px">
        <h3 style="margin-bottom: 20px; color: var(--primary)">
          <i class="fas fa-plus-circle"></i> Add New Product
        </h3>
        <div class="form-grid">
          <input
            type="text"
            id="pName"
            placeholder="Product Name (e.g. Red Shirt)"
          />
          <input type="number" id="pPrice" placeholder="Price ($)" />
          <select id="pCategory">
            <option value="shirt">Shirt</option>
            <option value="pants">Pants</option>
            <option value="shoes">Shoes</option>
            <option value="accessories">Accessories</option>
          </select>
          <input type="text" id="pImg" placeholder="Image URL (Link)" />
        </div>
        <button class="btn-add" onclick="addProduct()">Add Product Now</button>
      </div>

      <h2>Product List</h2>
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Price</th>
            <th>Category</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="productTableBody"></tbody>
      </table>
    </div>

    <script>
      // --- üîí SECURITY CHECK (·ûÄ·û∂·ûö·ûñ·û∂·ûö Admin) ---
      // ·ûä·û∂·ûÄ·üã·ûì·üÖ·ûî·ûì·üí·ûë·û∂·ûè·üã·ûõ·ûæ·ûÇ·üÅ·ûî·ûÑ·üí·û¢·ûü·üã·ûÄ·üí·ûì·ûª·ûÑ Script
      const currentUser = localStorage.getItem("username");

      // ·ûî·ûæ·ûò·û∑·ûì·ûë·û∂·ûì·üã Login ·û¨ ·ûò·û∑·ûì·ûò·üÇ·ûì·ûá·û∂·ûà·üí·ûò·üÑ·üá "admin" ·ûë·üÅ
      if (!currentUser || currentUser !== "admin") {
        alert("‚õî ·û¢·üí·ûì·ûÄ·ûÇ·üí·ûò·û∂·ûì·ûü·û∑·ûë·üí·ûí·û∑·ûÖ·ûº·ûõ·ûò·ûæ·ûõ·ûë·üÜ·ûñ·üê·ûö·ûì·üÅ·üá·ûë·üÅ! (Admins Only)");
        window.location.href = "login.html"; // ·ûí·û∂·ûÄ·üã·ûÖ·üÅ·ûâ·ûë·üÖ Login ·ûú·û∑·ûâ·ûó·üí·ûõ·û∂·ûò
      }

      const API_URL = "/api";

      // 1. Fetch Users
      async function fetchUsers() {
        try {
          const res = await fetch(`${API_URL}/admin/users`);
          const users = await res.json();
          document.getElementById("totalUsers").innerText = users.length;
        } catch (error) {
          console.error(error);
        }
      }

      // 2. Fetch Products
      async function fetchProducts() {
        try {
          const res = await fetch(`${API_URL}/products`);
          const products = await res.json();

          document.getElementById("totalProducts").innerText = products.length;

          const tbody = document.getElementById("productTableBody");
          if (products.length === 0) {
            tbody.innerHTML =
              "<tr><td colspan='5' style='text-align:center;'>No products found. Add one!</td></tr>";
            return;
          }

          tbody.innerHTML = products
            .map(
              (p) => `
            <tr>
                <td><img src="${p.img}" width="50" style="border-radius: 5px;"></td>
                <td>${p.name}</td>
                <td>$${p.price}</td>
                <td>${p.category}</td>
                <td>
                    <button class="btn-delete" onclick="deleteProduct(${p.id})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </td>
            </tr>
          `,
            )
            .join("");
        } catch (error) {
          console.error(error);
        }
      }

      // 3. Add Product
      async function addProduct() {
        const name = document.getElementById("pName").value;
        const price = document.getElementById("pPrice").value;
        const category = document.getElementById("pCategory").value;
        const img = document.getElementById("pImg").value;

        if (!name || !price || !img) return alert("Please fill all fields!");

        try {
          await fetch(`${API_URL}/products`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, price, category, img }),
          });
          alert("Product Added!");
          fetchProducts(); // Refresh list

          // Clear inputs
          document.getElementById("pName").value = "";
          document.getElementById("pPrice").value = "";
          document.getElementById("pImg").value = "";
        } catch (error) {
          alert("Error adding product");
        }
      }

      // 4. Delete Product
      async function deleteProduct(id) {
        if (!confirm("Are you sure you want to delete this product?")) return;
        try {
          await fetch(`${API_URL}/products/${id}`, { method: "DELETE" });
          fetchProducts();
        } catch (error) {
          alert("Error deleting product");
        }
      }

      function logout() {
        localStorage.clear();
        window.location.href = "login.html";
      }

      window.onload = function () {
        fetchUsers();
        fetchProducts();
      };
    </script>
  </body>
</html>
